---
title: "ТВИМС_ДЗ3_Смысловских"
author: "Елена Смысловских"
date: "30/05/2020"
output: 
  html_document:
        toc: true
        toc_depth: 3
        toc_float: true
---
Загружаем данные и необходимые для анализа пакеты:

```{r setup, message=FALSE}
library(haven)
library(psych)
library(ggplot2)
library(GGally)
library(factoextra)
library(dplyr)
library(shiny)
library(stats)

data <- readRDS('datwvs6.rds')
View(data)
df <- dplyr::filter(data, V2 == 504)
df <- dplyr::select(df, c(V131:V139))
rm(data)
```

В качестве страны для анализа возьмем Марокко, поскольку, как отмечают в своем исследовании [Klingemann и Welzel](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2390577), в этом государстве сравнительно высокий уровень поддержки демократии (90%) при низком развитии демократических институтов, т.е. можно сказать, что в условиях отсутствия демократии тем не менее есть запрос на нее от населения. Это может означать, что конвенциональное понимание демократии в Марокко может сильно отличаться от понимания демократии граждананми, например, европейских стран. В этом смысле можно использовать метод главных компонент для того, чтобы понять, какие характеристики демократии свойственно выделять жителям Марокко.

```{r pressure, echo=FALSE, out.width = '100%'}
knitr::include_graphics("dem preferences dem institutions.png")
```

Отфильтруем значения по коду страны (Марокко = 504). Заметим, что в датасете World Values Survey есть пропущенные значения: они закодированы от -1 до -5. После чистки осталось 701 наблюдение из 1200. 

```{r}
df[df < 0] <- NA
```


```{r}
df <- na.omit(df)
describe(df)
```

## Задание 1
Для удобства переименуем переменные.

```{r}
names(df)[1] <- "redistr" #"Governments tax the rich and subsidize the poor"
names(df)[2] <- "religious laws" #"Religious authorities interpret the laws"
names(df)[3] <- "free elections" #"People choose their leaders in free elections"
names(df)[4] <- "aid for unemployment" #"People receive state aid for unemployment"
names(df)[5] <- "army takes over" #"The army takes over when government is incompetent"
names(df)[6] <- "civil rights" #"Civil rights protect people’s liberty from state oppression"
names(df)[7] <- "equal incomes" #"The state makes people's incomes equal"
names(df)[8] <- "obey rulers" #"People obey their rulers"
names(df)[9] <- "women rights" #"Women have the same rights as men"
```

Сперва посмотрим на корреляции между переменными. Можно увидеть, что есть корреляции со значением ~ 0.5-0.6. Это значит, что метод главных компонент логично применить к нашим данным, поскольку с большой долей вероятности некоторые признаки будут более информативными в объяснении вариации.

```{r, fig.height = 7, fig.width = 7}
ggcorr(df, nbreaks = 10, label = T, size = 4, hjust = 0.9)
```

Поскольку при реализации МГК средние значения не должны сильно различаться, т.к. некоторым переменным будет присвоен больший вес и переменные не будут сравнимыми, будем брать нормализованные и центрированные значения (несмотря на то, что в целом переменные закодированы по одной шкале, разброс средних - от 6.55 до 8.49, поэтому используем center и scale).

```{r}
pca_results <- prcomp(df, center = TRUE, scale = TRUE)
summary(pca_results)
```

Найдем собственные значения.

```{r}
eig.val <- get_eigenvalue(pca_results)
eig.val
```

```3.7``` - вариация 1-й главной компоненты. Иными словами, это *значение* вариации, которую объясняет 1-я ГК. При этом доля объясняемой ею вариации во всей вариации- 41.2%.
Аналогично, ```1.25``` - вариация 2-й ГК, и объясняет она 13.9% всей вариации. ```0.97``` - вариация 3-й ГК, которая объясняет 10.8% всей вариации. И так далее. Суммарно девять признаков объясняют, соответственно, 100% всей вариации.

Заметим, что в сумме первые две ГК объясняют более половины всей вариации, а первые четыре главные компоненты - 74% вариации. Исходя из критерия информативности (70 - 75%), можно утверждать, что в анализ необходимо включить *первые четыре главные компоненты*, а прирост кумулятивной вариации, начиная с пятой ГК, уже не так велик.

*__Критерий информативности__ - мера отбора компонент для анализа, или минимальный процент вариации, суммарно объясненной показателями (как правило, 75%)*

Так или иначе, применение МГК в нашем случае целесообразно, так как из девяти признаков уже первые два объясняют более половины всей вариации, а первые четыре - почти 75%. Таким образом, они потенциально более информативны, чем все остальные, а потому имеет смысл анализировать меньшее количество признаков, тем самым снизив размерность признакового пространства.


## Задание 2

- Запишем уравнение, используя собственные векторы - веса показателей, и умножив на нормированные и центрированные переменные.

```{r}
#eigen(cor(df)) - неудобно :(
pca_results$rotation[,1:2]
```
Для ГК №1: 
$$PC_1 = - 0.38 \times V131 - 0.26 \times V132 - 0.39 \times V133 - 0.38 \times V134 - \\
0.2 \times V135 - 0.4 \times V136 - 0.4 \times V137 - 0.3 \times V138 - 0.19 \times V139 $$

Для ГК №2: 
$$PC_2 = - 0.06 \times V131 - 0.63 \times V132 - 0.16 \times V133 - 0.04 \times V134 - \\
0.5 \times V135 - 0.26 \times V136 - 0.1 \times V137 - 0.11 \times V138 - 0.48 \times V139 $$

- **Что мы понимаем из уравнений?** 

В первую ГК с наибольшим весом ~ 0.4 входят переменные V137, V136 и V133 (у V134 и V131 чуть меньший вес - 0.38). То есть, те переменные, которые измеряют защиту гражданских свобод от государства, обеспечение государством равенства доходов и свободные выборы в качестве выделяемых респондентами неотъемлемых характеристик демократии (показатели V134 и V131 - помощь безработным и перераспределение - тоже можно учесть). 

*(с учетом того, что у всех переменных положительные средние, мы должны помнить, что координаты повернулись, соответственно, в первой ГК они отражены с отрицательным знаком, хотя на самом деле он положительный. То есть интерпретация для всех наших главных компонент "весов" такова: чем больше вес, тем выше оценка респондентом показателя как "демократичного")*

При этом наменьшее значение имеют такие характеристики демократии, как подотчетность права религиозным лидерам (V132), право армии на захват власти в случае некомпетентности правительства (V135), равенство прав женщин и мужчин (V139).

Во вторую ГК с большими весами входят те признаки, которые имеют меньший вес в 1-й ГК: V132 с весом -0.63 (респонденты оценивают подотчетность права религиозным лидерам как менее "демократичный" индикатор, что логично), V135 с весом -0.5 (опять же, право армии на захват власти в случае некомпетентности правительства респонденты оценивают в качестве менее присущей демократии характеристики) и V134 с весом 0.48 (равенство прав женщин и мужчин как более присущая демократии характеристика).

- **Что содержательно отображают первые две ГК?**

Можно увидеть, что в **первой ГК** преобладают показатели, связанные с доходами населения, борьбой с экономическим неравенством, а также гражданскими правами и свободами. То есть, в качестве основных характеристик демократии респонденты видят именно те вещи, которые обеспечивают базовое преодоление неравенства. 
Во **второй ГК** мы видим общее направление - допуск или недопуск конкретных групп к политической власти (армия, церковь, женщины). Можно предположить, что вторая ГК - это более высокий уровень оценки демократии, который отображает равный доступ к власти и участию.

- **Как связаны исходные показатели с первыми двумя компонентами?**

Из графика вклада показателей в ГК №1 мы видим, что показатели ```equal incomes```, ```civil rights```, ```free elections```, ```aid for unemployment```, ```redistribution``` вносят существенно более высокий вклад в компоненту, чем остальные. 

```{r, fig.height = 4, fig.width = 6}
fviz_contrib(pca_results, choice = "var", axes = 1)
```

Из аналогичного графика для ГК №2 понятно, что наибольший вес в компоненте имеют показатели ```religious laws```, ```army takes over```, ```women rights```, а вес остальных очень мал.

```{r, fig.height = 4, fig.width = 6}
fviz_contrib(pca_results, choice = "var", axes = 2)
```
- **Построим график с первой и второй ГК по вертикали и горизонтали.**

```{r}
fviz_pca_var(pca_results, col.var = "contrib", repel = TRUE)
```

По горизонтали расположена первая ГК, по вертикали - вторая ГК. Из графика понятно, что все показатели обратно направлены первой ГК. В случае со второй ГК, с ней сонаправлены показатели ```redistribution```, ```obey rulers```, ```army takes over```, ```religious laws``` и обратно направлены показатели ```equal incomes```, ```civil rights```, ```free elections```, ```women rights```, ```aid for unemployment```. При этом мы видим, что у показателей ```aid for unemployment``` и ```redistribution``` - минимальная связь со второй ГК, поскольку они практически перпендикулярны ей.

При умножении на -1 мы получаем нужные знаки весов. На основе направлений векторов можно утверждать, что в первой ГК все показатели имеют положительный вес, а во второй ГК **положительный вес** - у показателей ```equal incomes```, ```civil rights```, ```free elections```, ```women rights```, ```aid for unemployment``` и **отрицательный** - у показателей ```redistribution```, ```obey rulers```, ```army takes over```, ```religious laws``` .

- Известно, что косинус угла между вектором и главной осью обозначает корреляцию между показателями и ГК. Так, чем ближе вектор расположен к главной оси, тем сильнее корреляция. 

Посмотрим на вектор показателя ```civil rights```: угол между вектором и ГК №1 составляет примерно 20 градусов. 
cos -α = cos α = 0.94. На графике вектор обратно направлен первой главной компоненте, однако мы помним, что все направления необходимо домножить на -1, соответственно, мы говорим, что корреляция между показателем гражданских прав как неотъемлемой черты демократии и первой главной компонентой характеристик равна 0.94.

Теперь рассмотрим вектор показателя ```women rights```. Угол между вектором и ГК №2 равен примерно 30 градусов. cos α = $\dfrac{\sqrt 3}{2}$ = 0.87. То есть, корреляция между равенством прав женщин и мужчин как характеристикой демократии и второй главной компонентой характеристик равна 0.87. 

## Задание 3
Посмотрим, какие же главные компоненты нам нужно отобрать для анализа на основе критериев Кайзера и Кеттела.

* **Критерий Кайзера** - устанавливает минимальное значение = 1 для компоненты, чтобы ее можно было включить в анализ*
```{r}
eig.val
```

По этому критерию у нас проходят только первые две главные компоненты, и чуть-чуть недотягивает третья.

***Критерий Кеттела** - ищет точку перелома на графике убывания вариации для того, чтобы отсечь те компоненты, которые наименее информативны, и где прирост вариации убывает. В этом критерии визуально ищется самый большой выступ, который соответствует наиболее значительному уменьшению прироста вариации.*

Визуализируем:

```{r}
fviz_eig(pca_results)
```

Из графика видно, что начиная с третьей ГК прирост вариации незначителен, и "колено" - вторая ГК. Делаем вывод, что нужно взять первые две ГК для анализа характеристик, наиболее важных для респондентов из Марокко.

## References
Welzel, Christian and Klingemann, Hans-Dieter, Evidencing and Explaining Democratic Congruence: The Perspective of 'Substantive' Democracy (August 31, 2008). World Values Research, WVR Volume 1, Number 3, 2008. Available at SSRN: https://ssrn.com/abstract=2390577 or http://dx.doi.org/10.2139/ssrn.2390577 


